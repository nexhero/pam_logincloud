
#+TITLE: PAM_PWOW
#+DESCRIPTION: A module pam to authenticate user, using an owncloud server.
#+AUTHOR: David Pereira.
#+EMAIL: inexhero@gmail.com
#+DATE: <2018-01-02 Tue>

* Requeriments
#+BEGIN_SRC sh
$sudo apt-get install build-essentical python-pip
$pip install pyocclient
$pip install docopt==0.6.2
$pip install pyinstaller
$pip install python-gnomekeyring
$git clone https://github.com/nexhero/loginCloud
$sudo cp -r loginCloud/ /usr/share/
$sudo ln -s /usr/share/loginCloud/logincloud.py /usr/bin/logincloud
$sudo ln -s /usr/share/loginCloud/cloudchpasswd.py /usr/bin/cloudchpasswd
$sudo ln -s /usr/share/loginCloud/clouduseradd.py /usr/bin/clouduseradd
$sudo ln -s /usr/share/loginCloud/ucs.py /usr/bin/ucs

#+END_SRC
* How to install.
#+BEGIN_SRC sh
$git clone https://github.com/nexhero/pam_logincloud
$cd pam_pwow/
$gcc -fPIC -fno-stack-protector -c pam_logincloud.c
$sudo ld -x --shared -o /lib/security/pam_logincloud.so pam_logincloud.o
#+END_SRC
* Configure.
** Create /etc/logincloud.conf file.
   This file will contain the server's URL where the owncloud server is.
#+BEGIN_EXAMPLE
[server]
service = OwnCloud
host = http://myowncloud.server/
#+END_EXAMPLE
** PAM confgiuration.
*** On the Display Manager Service.
    For example, on Debian using lightdm, edit the next file:
    /etc/pam.d/lightdm
    Add the next code at the first line of the file.
    #+BEGIN_EXAMPLE
    auth optional pam_logincloud.so
    #+END_EXAMPLE
*** Edit common-auth service PAM.
    On Debian edit the file /etc/pam.d/common-auth
In the line
#+BEGIN_EXAMPLE
auth	[success=1 default=ignore]	pam_unix.so nullok_secure
#+END_EXAMPLE
Change to.
#+BEGIN_EXAMPLE
auth	[success=1 default=ignore]	pam_unix.so nullok_secure try_first_pass
#+END_EXAMPLE
* Support.
If you are having issues, please let us know. David Pereira <inexhero@gmail.com>


